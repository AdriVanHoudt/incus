<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Incus by briankassouf</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Incus</h1>
        <p class="header">A real-time messaging server that acts as the intermediary between your web app and a browser.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/briankassouf/incus/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/briankassouf/incus/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/briankassouf/incus">View On GitHub</a></li>
        </ul>

        <p class="header">by <a class="header name" href="https://github.com/briankassouf">briankassouf</a></p>


      </header>
      <section>
        <h1><a name="installing-incus" class="anchor" href="#installing-incus"><span class="octicon octicon-link"></span></a>Installing Incus</h1>

        <h2>Method 1: Docker</h2>

        <p>Install <a href="https://docs.docker.com/installation/#installation">Docker</a></p>

        <p>Start an instance of Redis: </p>
        <pre><code>docker run -d --name incusredis redis</code></pre>

        <p>Start Incus: </p>
        <pre><code>docker run -d --link incusredis:redis --name incus \
        -p 4000:4000 jwgur/incus </pre></code>

        <h2>Method 2: Manual</h2>

<p>Install GO: <a href="http://golang.org/doc/install">http://golang.org/doc/install</a></p>

<p>An instance of Redis is needed to cluster Incus machines or for a webapp to communicate with Incus. </p>

<p>install GO libraries</p>

<pre><code>go get github.com/briankassouf/cfg
go get github.com/gosexy/redis
go get github.com/gorilla/websocket
</code></pre>

<p>Create the proper directory in your $GOPATH </p>

<pre><code>mkdir $GOPATH/src/github.com/briankassouf/incus
</code></pre>

<p>Clone, or download incus into that directory. 
Then create and move binary into install directory and run install.sh</p>

<pre><code>cd $GOPATH/src/github.com/briankassouf/incus
go install
cp $GOPATH/bin/incus $GOPATH/src/github.com/briankassouf/incus/install/.
sudo ./$GOPATH/src/github.com/briankassouf/incus/install.sh
</code></pre>

<p>Starting, Stopping, Restarting incus</p>

<pre><code>sudo /etc/init.d/incus start
sudo /etc/init.d/incus stop
sudo /etc/init.d/incus restart
</code></pre>

<h1>
<a name="configuring-incus" class="anchor" href="#configuring-incus"><span class="octicon octicon-link"></span></a>Configuring Incus</h1>

<p>You can configure Incus by passing environment variables: </p>

<h3>CLIENT_BROADCASTS</h3>

<dl>
    <dt>true</dt>
    <dd>Clients may send messages to other clients</dd>

    <dt>false</dt>
    <dd>Clients may not send messages to other clients.</dd>
</dl>

<p>Default: <strong>true</strong></p>

<h3>LISTENING_PORT</h3>

<p>This value controls the port that Incus binds to (TCP).</p>
<p>Default: <strong>4000</strong></p>

<h3>CONNECTION_TIMEOUT</h3>

<p>This value controls how long TCP connections are held open for.</p>

<dl>
    <dt>0</dt>
    <dd>Connections are held open forever.</dd>

    <dt>anything else</dt>
    <dd>Connections are held open for this many seconds.</dd>
</dl>

<p>Default: <strong>0</strong></p>

<h3>LOG_LEVEL</h3>

<dl>
    <dt>debug</dt>
    <dd>All messages, including errors and debug are printed to standard output.</dd>
    <dt>error</dt>
    <dd>Only errors are printed to standard output.</dd>
</dl>

<p>Default: <strong>debug</strong></p>

<h3>REDIS_PORT_6379_TCP_ADDR</h3>

<p>This value controls the TCP address (or hostname) to connect to Redis.</p>
<p>Note: The environment variable name is always <strong>REDIS_PORT_6379_TCP_ADDR</strong> even if the port is not 6379.</p>
<p>Default: <strong>127.0.0.1</strong></p>

<h3>REDIS_PORT_6379_TCP_PORT</h3>

<p>This value controls the TCP port to connect to Redis.</p>
<p>Note: The environment variable name is always <strong>REDIS_PORT_6379_TCP_PORT</strong> even if the port is not 6379.</p>
<p>Default: <strong>6379</strong></p>

<h3>REDIS_MESSAGE_CHANNEL</h3>

<p>This value controls the <a href="http://redis.io/topics/pubsub">Redis PubSub</a> channel to use.</p>
<p>Default: <strong>Incus</strong></p>

<h3>TLS_ENABLED</h3>

<p>This value controls whether the server will also listen on a TLS-enabled port.</p>

<dl>
    <dt>false</dt>
    <dd>TLS is disabled, so the server will only listen over its insecure port.</dd>

    <dt>true</dt>
    <dd>TLS is enabled, so the socket will listen over both its insecure port and its TLS-enabled secure port.</dd>
</dl>

<p>Default: <strong>false</strong></p>

<h3>TLS_PORT</h3>

<p>This value controls what TCP port is exposed when using TLS</p>
<p>Default: <strong>443</strong></p>

<h3>CERT_FILE</h3>

<p>This value controls what X.509 certificate is offered to clients connecting on the TLS port. The certificate is expected in PEM format. The 
value is a path name resolved relative to the working directory of Incus. </p>
<p>Default: <strong>cert.pem</strong></p>

<h3>KEY_FILE</h3>

<p>This value controls what X.509 private key is used for decrypting the TLS traffic. The key is expected in PEM format. </p>
<p>Default: <strong>key.pem</strong></p>

<h1>
    <a name="using-incus" class="anchor" href="#using-incus"><span class="octicon octicon-link"></span></a>Using Incus
</h1>
<p></p>Once incus is running you can include incus.js onto your site.</p>
<p>Here's the basic usage of incus.js</p>
<pre><code>var socket = new Incus('http://localhost:4000', 'UID', '/page/path');
socket.on('connect', function() {
    console.log('connected');
}

socket.on('Event', function(data) {
    alert(data);
}

socket.on('Event1', function (data) {
   console.log(data);
}

socket.on('Event2', function(data) {
    console.log('neat');
} 

var data = {data: 'dummy-data'};

$('#button').on('click', function() {
    socket.MessageUser('Event', 'UID', data); 
    socket.MessageAll('Event1', data);
    socket.MessagePage('Event2', '/page/path', data);
});

</pre></code>
<p>UID is a unique identifier for the user. It can be anywhere from an auto incremented ID to something more privage such as a session id or OAuth token.</p>


<p>To send events to Incus from your webapp you need to publish a json formated string to a Redis channel that Incus is listening on. This channel can be defined in the config file but defaults to Incus. The json format is as follows:</p>
<pre><code>{
    'command' : {
        'command' : string (message|setpage),
        'user'    : (optional) string -- UID,
        'page'    : (optional) string -- page identifier
    },
    'message' : {
        'event' : string,
        'data'  : object,
        'time'  : int
    }
}
</code></pre>

	<p>the command is used to route the message to the correct user.</p>
	<ul>
	    <li>if user and page are both unset message will be sent to all users</li>
	    <li>if both user and page are set message will be sent to that user on that page</li>
	</ul>
	   
	<p>The data inside message will be sent to the clients that are specified in command.</p>
</p>
      </section>
      </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
